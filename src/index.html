<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Telegrama</title>
  </head>
  <body>
    <h1>Telegrama ðŸ“¯</h1>
    <form onsubmit="enviarMensagem(event)">
      <input type="text" id="conteudo" placeholder="Mensagem" />
      <button type="submit">Enviar</button>
    </form>
    <div id="mensagens"></div>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script>
      // Initialize Cloud Firestore through Firebase
      firebase.initializeApp({
        apiKey: "AIzaSyAyTLTqMuDSaf4DnrPK-pYJe4f29h0g-lk",
        authDomain: "telegrama-91b14.firebaseapp.com",
        projectId: "telegrama-91b14",
      });

      var db = firebase.firestore();

      db.collection("mensagens")
        .orderBy("criacao", "desc")
        .onSnapshot((querySnapshot) => {
          const mensagensElm = document.querySelector("#mensagens");
          mensagensElm.replaceChildren();
          querySnapshot.forEach((doc) => {
            const pElm = document.createElement("p");
            const textElm = document.createTextNode(doc.data().conteudo);
            pElm.appendChild(textElm);
            mensagensElm.appendChild(pElm);
          });
        });

      function enviarMensagem(event) {
        event.preventDefault();
        let conteudo = document.querySelector("#conteudo").value;
        let criacao = new Date();
        if (conteudo) {
          db.collection("mensagens")
            .add({ conteudo, criacao })
            .catch((error) => {
              console.error("Error adding document: ", error);
            })
            .finally(() => {
              document.querySelector("#conteudo").value = "";
            });
        }
      }
    </script>
  </body>
</html>
